<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.hw.dao.ProductDAO">

	<select id="getProductMasterVOMaxId" resultType="String">
		SELECT CONCAT('PRODUCT', (SELECT LPAD(IFNULL(MAX(SUBSTR(TRIM(id), 8)), 0)+1, 6, '0') FROM product_master)) AS id FROM DUAL
	</select>
	
	<insert id="insertProductMasterVO" parameterType="productMasterVO">
		INSERT INTO product_master
		(
			id
			, product_name
			, product_price
			, product_qty
			, product_description
			, product_image
			, reg_dtm
			, updt_dtm
		)
		VALUES
		(
			#{id}
			, #{productName}
			, #{productPrice}
			, #{productQty}
			, #{productDescription}
			, #{productImage}
			, NOW()
			, #{updtDtm}
		)
	</insert>
	
	<select id="getProductMasterAllList" resultType="productMasterVO">
		SELECT 
			a.id                                                                             	AS id                
			, a.product_name                                                                    AS productName       
			, a.product_price                                                                   AS productPrice
			, a.product_qty                                                                     AS productQty      
			, a.product_description                                                             AS productDescription
			, a.product_image                                                                   AS productImage      
			, a.reg_dtm                                                                         AS regDtm            
			, a.updt_dtm                                                                        AS updtDtm            
		FROM
			product_master a
	</select>
	
	<insert id="insertProductDetailVO" parameterType="productMasterVO">
		INSERT INTO product_detail
		(
			id
			, seq
			, parts_type_cd
			, parts_id
			, parts_qty
			, parts_price
			, parts_total_price
			, parts_image
			, reg_dtm
			, updt_dtm
		)
		VALUES
		(
			#{id}
			, #{seq}
			, #{partsTypeCd}
			, #{partsId}
			, #{partsQty}
			, #{partsPrice}
			, #{partsTotalPrice}
			, #{partsImage}
			, NOW()
			, #{updtDtm}
		)
	</insert>
	
	<select id="getProductDetailAllList" parameterType="productMasterVO" resultType="productDetailVO">
		SELECT 
			a.id                                                                              AS id             
			, a.seq                                                                           AS seq            
			, a.parts_type_cd                                                                 AS partsTypeCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'COM003' AND cd = a.parts_type_cd )     AS partsTypeCdNm    
			, a.parts_id                                                                      AS partsId        
			, a.parts_qty                                                                     AS partsQty            
			, a.parts_price                                                                   AS partsPrice     
			, a.parts_total_price                                                             AS partsTotalPrice
			, a.parts_image                                                                   AS partsImage     
			, a.reg_dtm                                                                       AS regDtm         
			, a.updt_dtm                                                                      AS updtDtm        
		FROM
			product_detail a 
		WHERE
			a.id = #{id}
	</select>
	
</mapper>