<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.hw.dao.ProductDAO">

	<select id="getProductMasterVOMaxId" resultType="String">
		SELECT CONCAT('PRODUCT', (SELECT LPAD(IFNULL(MAX(SUBSTR(TRIM(id), 8)), 0)+1, 9, '0') FROM product_master)) AS id FROM DUAL
	</select>
	
	<insert id="insertProductMasterVO" parameterType="productMasterVO">
		INSERT INTO product_master
		(
			id
			, product_name
			, product_price
			, product_qty
			, product_description
			, product_image
			, reg_dtm
			, updt_dtm
			, product_regist_path_cd
			, windows_name
			, windows_price
		)
		VALUES
		(
			#{id}
			, #{productName}
			, #{productPrice}
			, #{productQty}
			, #{productDescription}
			, #{productImage}
			, NOW()
			, #{updtDtm}
			, #{productRegistPathCd}
			, #{windowsName}
			, #{windowsPrice}
		)
	</insert>
	
	<select id="getProductMasterAllList" resultType="productMasterVO">
		SELECT 
			a.id                                                                             	AS id                
			, a.product_name                                                                    AS productName       
			, a.product_price                                                                   AS productPrice
			, FORMAT(a.product_price, 0)                                                        AS productPriceStr
			, a.product_qty                                                                     AS productQty      
			, a.product_description                                                             AS productDescription
			, a.product_image                                                                   AS productImage
			, (SELECT GROUP_CONCAT(parts_name SEPARATOR '|') FROM product_detail WHERE id = a.id) AS productDetailListStr
			, a.reg_dtm                                                                         AS regDtm            
			, a.updt_dtm                                                                        AS updtDtm
			, a.product_regist_path_cd                                                          AS productRegistPathCd            
		FROM
			product_master a
		WHERE
			a.product_regist_path_cd = '01'
	</select>
	
	<insert id="insertProductDetailVO" parameterType="productDetailVO">
		INSERT INTO product_detail
		(
			id
			, seq
			, parts_type_cd
			, parts_id
			, parts_name
			, parts_qty
			, parts_price
			, parts_total_price
			, parts_image
			, reg_dtm
			, updt_dtm
			, parts_history_seq
		)
		VALUES
		(
			#{id}
			, #{seq}
			, #{partsTypeCd}
			, #{partsId}
			, #{partsName}
			, #{partsQty}
			, #{partsPrice}
			, #{partsTotalPrice}
			, #{partsImage}
			, NOW()
			, #{updtDtm}
			, #{partsHistorySeq}
		)
	</insert>
	
	<select id="getProductMallList" resultType="productMasterVO">
		SELECT 
			a.id                                                                             	AS id                
			, a.product_name                                                                    AS productName       
			, a.product_price                                                                   AS productPrice
			, a.product_qty                                                                     AS productQty      
			, a.product_description                                                             AS productDescription
			, a.product_image                                                                   AS productImage      
			, a.reg_dtm                                                                         AS regDtm            
			, a.updt_dtm                                                                        AS updtDtm
			<!-- , CONCAT(a.product_name, '&lt;br&gt;', FORMAT(a.product_price, 0), '원&lt;br&gt;', REPLACE(a.product_description, '\n', '&lt;br&gt;')) AS productMallInfo -->
			<![CDATA[
			, CONCAT('<b>', a.product_name, '</b><br><br>', FORMAT(a.product_price, 0), '원<br><br>', REPLACE(a.product_description, '\n', '<br>')) AS productMallInfo
			]]>
		FROM
			product_master a
		WHERE
			a.product_qty >= 1
			AND a.product_regist_path_cd = '01'
	</select>
	
	<select id="getProductMasterById" parameterType="String" resultType="productMasterVO">
		SELECT 
			a.id                                                                             	AS id                
			, a.product_name                                                                    AS productName       
			, a.product_price                                                                   AS productPrice
			, CONCAT(FORMAT(a.product_price, 0), '원')                                           AS productPriceStr
			, a.product_qty                                                                     AS productQty      
			, a.product_description                                                             AS productDescription
			<![CDATA[
			, REPLACE(REPLACE(a.product_description, '\n', '<br>'), '\r', '')               AS productDescriptionStr
			]]>
			, a.product_image                                                                   AS productImage      
			, a.reg_dtm                                                                         AS regDtm            
			, a.updt_dtm                                                                        AS updtDtm
			, (SELECT COUNT(b.id) AS cnt FROM order_detail b WHERE a.id = b.product_id)         AS orderDetailCnt
			, a.product_regist_path_cd                                                          AS productRegistPathCd
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRO001' AND cd = a.product_regist_path_cd )     AS productRegistPathCdNm
			, a.windows_name                                                                    AS windowsName
			, a.windows_price                                                                   AS windowsPrice            
		FROM
			product_master a
		WHERE
			a.id = #{id}
	</select>
	
	<update id="updateProductMasterVO" parameterType="productMasterVO">
		UPDATE
			product_master
		SET
			id                    			= #{id}                
			, product_name        			= #{productName}       
			, product_price       			= #{productPrice}      
			, product_qty         			= #{productQty}        
			, product_description 			= #{productDescription}
			, product_image       			= #{productImage}      
			, updt_dtm            			= NOW()
			, product_regist_path_cd        = #{productRegistPathCd}
			, windows_name                  = #{windowsName}   
			, windows_price                 = #{windowsPrice}                  
		WHERE
			id = #{id}
	</update>
	
	<select id="getProductDetailById" parameterType="String" resultType="productDetailVO">
		SELECT 
			a.id                                                                              AS id             
			, a.seq                                                                           AS seq            
			, a.parts_type_cd                                                                 AS partsTypeCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'COM003' AND cd = a.parts_type_cd )     AS partsTypeCdNm    
			, a.parts_id                                                                      AS partsId
			, a.parts_name                                                                    AS partsName        
			, a.parts_qty                                                                     AS partsQty            
			, a.parts_price                                                                   AS partsPrice     
			, a.parts_total_price                                                             AS partsTotalPrice
			, a.parts_image                                                                   AS partsImage     
			, a.reg_dtm                                                                       AS regDtm         
			, a.updt_dtm                                                                      AS updtDtm
			, a.parts_history_seq                                                             AS partsHistorySeq        
		FROM
			product_detail a 
		WHERE
			a.id = #{id}
	</select>
	
	<delete id="deleteProductDetailVO" parameterType="productDetailVO">
		DELETE
		FROM
			product_detail
		WHERE
			id = #{id}
	</delete>
	
	<select id="getGpuHistoryAllListByTargetDate" resultType="partsGpuHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                              AS id
			, a.history_seq                                                                   AS historySeq        
			, a.parts_name                                                                    AS partsName 
			, a.parts_price                                                                   AS partsPrice
			, FORMAT(a.parts_price, 0)                                                        AS partsPriceStr
			, a.gled_cd                                                                       AS gledCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'COM002' AND cd = a.gled_cd)     AS gledCdNm  
			, a.gn                                                                            AS gn        
			, a.gmc_cd                                                                        AS gmcCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT001' AND cd = a.gmc_cd)      AS gmcCdNm   
			, a.gsc_cd                                                                        AS gscCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT002' AND cd = a.gsc_cd)      AS gscCdNm   
			, a.gsv                                                                           AS gsv       
			, a.maker_id                                                                      AS makerId   
			, (SELECT maker_name FROM parts_maker WHERE id = a.maker_id)                      AS makerNm 
			, a.qc                                                                            AS qc        
			, a.tdp                                                                           AS tdp       
			, a.bn                                                                            AS bn        
			, a.il                                                                            AS il        
			, a.gpl                                                                           AS gpl       
			, a.twelve_pin                                                                    AS twelvePin 
			, a.parts_image                                                                   AS partsImage
			, a.reg_dtm                                                                       AS regDtm    
			, a.multi_bulk                                                                    AS multiBulk
			, a.gc                                                                            AS gc
		FROM
			parts_gpu_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_gpu_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
		/* 23.07.30 견적산출 알고리즘 11번에서 필요한 가격 정렬조건 추가 */  
		ORDER BY a.parts_price ASC
	</select>
	
	<select id="getCpuHistoryAllListByTargetDate" resultType="partsCpuHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                               AS id
			, a.history_seq                                                                    AS historySeq
			, a.parts_name                                                                     AS partsName   
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr  
			, a.csv                                                                            AS csv         
			, a.ia_cd                                                                          AS iaCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT009' AND cd = a.ia_cd)        AS iaCdNm   
			, a.thermal                                                                        AS thermal     
			, a.bn                                                                             AS bn          
			, a.cpu_soc_cd                                                                     AS cpuSocCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT007' AND cd = a.cpu_soc_cd)   AS cpuSocCdNm  
			, a.vrm_range                                                                      AS vrmRange    
			, a.ddr4_max_range                                                                 AS ddr4MaxRange
			, a.ddr5_max_range                                                                 AS ddr5MaxRange
			, a.parts_image                                                                    AS partsImage  
			, a.reg_dtm                                                                        AS regDtm      
			, a.multi_bulk                                                                     AS multiBulk
			, a.apu                                                                            AS apu
			, a.cl_soc                                                                         AS clSoc
		FROM
			parts_cpu_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_cpu_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
		/* 23.08.01 견적산출 알고리즘 11번에서 필요한 가격 정렬조건 추가 */  
		ORDER BY a.parts_price ASC
	</select>
	
	<select id="getMbHistoryAllListByTargetDate" resultType="partsMbHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                               AS id
			, a.history_seq                                                                    AS historySeq
			, a.parts_name                                                                     AS partsName 
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr
			, a.mled_cd                                                                        AS mledCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'COM002' AND cd = a.mled_cd)      AS mledCdNm  
			, a.mmc_cd                                                                         AS mmcCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT004' AND cd = a.mmc_cd)       AS mmcCdNm   
			, a.msc_cd                                                                         AS mscCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT005' AND cd = a.msc_cd)       AS mscCdNm   
			, a.maker_id                                                                       AS makerId    
			, (SELECT maker_name FROM parts_maker WHERE id = a.maker_id)                       AS makerNm   
			, a.port                                                                           AS port      
			, a.scal                                                                           AS scal      
			, a.bios                                                                           AS bios      
			, a.cpu_soc_cd                                                                     AS cpuSocCd  
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT007' AND cd = a.cpu_soc_cd)   AS cpuSocCdNm
			, a.vrm_range                                                                      AS vrmRange  
			, a.mem_soc_cd                                                                     AS memSocCd  
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT024' AND cd = a.mem_soc_cd)   AS memSocCdNm
			, a.scs_cd                                                                         AS scsCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT008' AND cd = a.scs_cd)       AS scsCdNm   
			, a.ff                                                                             AS ff        
			, a.pl                                                                             AS pl        
			, a.sata                                                                           AS sata      
			, a.parts_image                                                                    AS partsImage
			, a.reg_dtm                                                                        AS regDtm    
			, a.multi_bulk                                                                     AS multiBulk
			, a.wifi                                                                           AS wifi
			, a.mc                                                                             AS mc
			, a.lim_vrm                                                                        AS limVrm
			, a.qc                                                                             AS qc
		FROM
			parts_mb_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_mb_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
		/* 23.08.01 견적산출 알고리즘 11번에서 필요한 가격 정렬조건 추가 */  
		ORDER BY a.parts_price ASC
	</select>
	
	<select id="getRamHistoryAllListByTargetDate" resultType="partsRamHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                               AS id          
			, a.history_seq                                                                    AS historySeq
			, a.parts_name                                                                     AS partsName   
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr  
			, a.rled_cd                                                                        AS rledCd      
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'COM002' AND cd = a.rled_cd)      AS rledCdNm    
			, a.rmc_cd                                                                         AS rmcCd       
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT010' AND cd = a.rmc_cd)       AS rmcCdNm     
			, a.rsc_cd                                                                         AS rscCd       
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT011' AND cd = a.rsc_cd)       AS rscCdNm     
			, a.cl                                                                             AS cl          
			, a.latency                                                                        AS latency          
			, a.pr_cd                                                                          AS prCd        
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT012' AND cd = a.pr_cd)        AS prCdNm      
			, a.mem_soc_cd                                                                     AS memSocCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT024' AND cd = a.mem_soc_cd)   AS memSocCdNm  
			, a.ddr4_max_range                                                                 AS ddr4MaxRange
			, a.ddr5_max_range                                                                 AS ddr5MaxRange
			, a.parts_image                                                                    AS partsImage  
			, a.reg_dtm                                                                        AS regDtm      
			, a.multi_bulk                                                                     AS multiBulk
			, a.volume                                                                         AS volume
			, a.sd                                                                             AS sd     
		FROM
			parts_ram_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_ram_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
		/* 23.08.01 견적산출 알고리즘 11번에서 필요한 가격 정렬조건 추가 */  
		ORDER BY a.parts_price ASC
	</select>
	
	<select id="getPsuHistoryAllListByTargetDate" resultType="partsPsuHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                               AS id        
			, a.history_seq                                                                    AS historySeq
			, a.parts_name                                                                     AS partsName 
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr
			, a.pmc_cd                                                                         AS pmcCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT013' AND cd = a.pmc_cd)       AS pmcCdNm   
			, a.psc_cd                                                                         AS pscCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT014' AND cd = a.psc_cd)       AS pscCdNm   
			, a.std                                                                            AS std       
			, a.maker_id                                                                       AS makerId     
			, a.pfm                                                                            AS pfm       
			, a.sft                                                                            AS sft       
			, a.tdp                                                                            AS tdp       
			, a.pl                                                                             AS pl        
			, a.gpl                                                                            AS gpl       
			, a.twelve_pin                                                                     AS twelvePin 
			, a.parts_image                                                                    AS partsImage
			, a.reg_dtm                                                                        AS regDtm    
			, a.multi_bulk                                                                     AS multiBulk
			, a.qc                                                                             AS qc
		FROM
			parts_psu_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_psu_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
		/* 23.08.01 견적산출 알고리즘 11번에서 필요한 가격 정렬조건 추가 */  
		ORDER BY a.parts_price ASC
	</select>
	
	<select id="getCaseHistoryAllListByTargetDate" resultType="partsCaseHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                               AS id   
			, a.history_seq                                                                    AS historySeq          
			, a.parts_name                                                                     AS partsName      
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr     
			, a.cled_cd                                                                        AS cledCd         
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'COM002' AND cd = a.cled_cd)      AS cledCdNm
			, a.cm_cd                                                                          AS cmCd           
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT023' AND cd = a.cm_cd)        AS cmCdNm
			, a.cmc_cd                                                                         AS cmcCd          
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT015' AND cd = a.cmc_cd)       AS cmcCdNm
			, a.csc_cd                                                                         AS cscCd          
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT016' AND cd = a.csc_cd)       AS cscCdNm
			, a.maker_id                                                                       AS makerId       
			, (SELECT maker_name FROM parts_maker WHERE id = a.maker_id)                       AS makerNm 
			, a.adap                                                                           AS adap           
			, a.cool                                                                           AS cool           
			, a.end                                                                            AS end            
			, a.conv                                                                           AS conv           
			, a.ff                                                                             AS ff             
			, a.iw                                                                             AS iw             
			, a.il                                                                             AS il             
			, a.ih                                                                             AS ih             
			, a.it                                                                             AS it             
			, a.fh                                                                             AS fh             
			, a.ft                                                                             AS ft             
			, a.str_two_dot_five                                                               AS strTwoDotFive  
			, a.str_three_dot_five                                                             AS strThreeDotFive
			, a.parts_image                                                                    AS partsImage     
			, a.reg_dtm                                                                        AS regDtm         
			, a.multi_bulk                                                                     AS multiBulk
			, a.qc                                                                             AS qc
		FROM
			parts_case_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_case_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
		/* 23.08.01 견적산출 알고리즘 11번에서 필요한 가격 정렬조건 추가 */  
		ORDER BY a.parts_price ASC
	</select>
	
	<select id="getCoolerHistoryAllListByTargetDate" resultType="partsCoolerHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                               AS id       
			, a.history_seq                                                                    AS historySeq 
			, a.parts_name                                                                     AS partsName 
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr
			, a.clled_cd                                                                       AS clledCd   
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'COM002' AND cd = a.clled_cd)     AS clledCdNm
			, a.clmc_cd                                                                        AS clmcCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT018' AND cd = a.clmc_cd)      AS clmcCdNm
			, a.clsc_cd                                                                        AS clscCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT019' AND cd = a.clsc_cd)      AS clscCdNm
			, a.formula_cd                                                                     AS formulaCd 
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT020' AND cd = a.formula_cd)   AS formulaCdNm
			, a.sta                                                                            AS sta       
			, a.wcas                                                                           AS wcas      
			, a.acas                                                                           AS acas      
			, a.noi                                                                            AS noi       
			, a.cnv                                                                            AS cnv       
			, a.thermal                                                                        AS thermal   
			, a.iw                                                                             AS iw        
			, a.ih                                                                             AS ih        
			, a.it                                                                             AS it        
			, a.parts_image                                                                    AS partsImage
			, a.reg_dtm                                                                        AS regDtm    
			, a.multi_bulk                                                                     AS multiBulk
			, a.cl_soc                                                                         AS clSoc
			, a.qc                                                                             AS qc
		FROM
			parts_cooler_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_cooler_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
		/* 23.08.01 견적산출 알고리즘 11번에서 필요한 가격 정렬조건 추가 */  
		ORDER BY a.parts_price ASC
	</select>
	
	<select id="getHddHistoryAllListByTargetDate" resultType="partsHddHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                               AS id  
			, a.history_seq                                                                    AS historySeq           
			, a.parts_name                                                                     AS partsName      
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr     
			, a.spd                                                                            AS spd            
			, a.fea                                                                            AS fea            
			, a.rel                                                                            AS rel            
			, a.noice                                                                          AS noice          
			, a.mttf                                                                           AS mttf           
			, a.gur                                                                            AS gur            
			, a.str_three_dot_five                                                             AS strThreeDotFive
			, a.sata                                                                           AS sata           
			, a.parts_image                                                                    AS partsImage     
			, a.reg_dtm                                                                        AS regDtm         
			, a.multi_bulk                                                                     AS multiBulk
			, a.volume                                                                         AS volume
			, a.qc                                                                             AS qc
		FROM
			parts_hdd_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_hdd_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
	</select>
	
	<select id="getSsdHistoryAllListByTargetDate" resultType="partsSsdHistoryVO" parameterType="String">
		SELECT 
			a.id                                                                               AS id      
			, a.history_seq                                                                    AS historySeq     
			, a.parts_name                                                                     AS partsName    
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr   
			, a.basic                                                                          AS basic        
			, a.fnc                                                                            AS fnc          
			, a.cmf                                                                            AS cmf          
			, a.war                                                                            AS war          
			, a.thr                                                                            AS thr          
			, a.rlb                                                                            AS rlb          
			, a.str_two_dot_five                                                               AS strTwoDotFive
			, a.scs_cd                                                                         AS scsCd        
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT008' AND cd = a.scs_cd)       AS scsCdNm      
			, a.sata                                                                           AS sata         
			, a.parts_image                                                                    AS partsImage   
			, a.reg_dtm                                                                        AS regDtm       
			, a.multi_bulk                                                                     AS multiBulk
			, a.volume                                                                         AS volume
			, a.qc                                                                             AS qc
		FROM
			parts_ssd_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_ssd_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
		/* 23.08.01 견적산출 알고리즘 11번에서 필요한 가격 정렬조건 추가 */  
		ORDER BY a.parts_price ASC
	</select>
	
	<select id="getSfHistoryAllListByTargetDate" resultType="partsSfHistoryVO" parameterType="String">
		SELECT
			a.id                                                                               AS id     
			, a.history_seq                                                                    AS historySeq   
			, a.parts_name                                                                     AS partsName 
			, a.parts_price                                                                    AS partsPrice
			, FORMAT(a.parts_price, 0)                                                         AS partsPriceStr
			, a.fled_cd                                                                        AS fledCd    
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'COM002' AND cd = a.fled_cd)      AS fledCdNm  
			, a.fmc_cd                                                                         AS fmcCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT021' AND cd = a.fmc_cd)       AS fmcCdNm   
			, a.fsc_cd                                                                         AS fscCd     
			, (SELECT nm FROM comn_cd_detail WHERE comn_cd = 'PRT022' AND cd = a.fsc_cd)       AS fscCdNm   
			, a.fnoi                                                                           AS fnoi      
			, a.ffm                                                                            AS ffm       
			, a.fh                                                                             AS fh        
			, a.ft                                                                             AS ft        
			, a.parts_image                                                                    AS partsImage
			, a.reg_dtm                                                                        AS regDtm    
			, a.multi_bulk                                                                     AS multiBulk
			, a.qc                                                                             AS qc
		FROM
			parts_sf_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_sf_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
	</select>
	
	<select id="getMakerHistoryAllListByTargetDate" resultType="partsMakerHistoryVO" parameterType="String">
		SELECT
			a.id                                                                               AS id  
			, a.history_seq                                                                    AS historySeq      
			, a.maker_name                                                                     AS makerName 
			, a.as_score                                                                       AS asScore
			, a.reg_dtm                                                                        AS regDtm    
		FROM
			parts_maker_history a
		WHERE
			(id, history_seq) 
				IN (
					SELECT 
						id
						, MAX(history_seq) AS history_seq
					FROM 
						parts_maker_history
					WHERE 
					    <if test="targetDate != null and targetDate != ''">
					    	<![CDATA[
					    	reg_dtm <= #{targetDate}
					    	]]> 
					    </if>
						<if test="targetDate == null or targetDate == ''">
							<![CDATA[
					    	reg_dtm <= NOW()
					    	]]>  
					    </if>
					GROUP BY id 
				)
	</select>


	
	<select id="getBanpumMasterVOMaxId" resultType="String">
		SELECT CONCAT('BANPUM', (SELECT LPAD(IFNULL(MAX(SUBSTR(TRIM(id), 7)), 0)+1, 9, '0') FROM banpum_master)) AS id FROM DUAL
	</select>
	
	<insert id="insertBanpumMasterVO" parameterType="banpumMasterVO">
		INSERT INTO banpum_master
		(
			id
			, banpum_name
			, banpum_price
			, banpum_qty
			, banpum_description
			, exposure_yn
			, banpum_image1
			, banpum_image2
			, banpum_image3
			, banpum_image4
			, banpum_image5
			, banpum_image6
			, banpum_image7
			, banpum_image8
			, banpum_image9
			, banpum_image10
			, banpum_image11
			, banpum_image12
			, banpum_image13
			, banpum_image14
			, banpum_image15
			, reg_dtm
			, updt_dtm
		)
		VALUES
		(
			#{id}
			, #{banpumName}
			, #{banpumPrice}
			, #{banpumQty}
			, #{banpumDescription}
			, #{exposureYn}
			, #{banpumImage1}
			, #{banpumImage2}
			, #{banpumImage3}
			, #{banpumImage4}
			, #{banpumImage5}
			, #{banpumImage6}
			, #{banpumImage7}
			, #{banpumImage8}
			, #{banpumImage9}
			, #{banpumImage10}
			, #{banpumImage11}
			, #{banpumImage12}
			, #{banpumImage13}
			, #{banpumImage14}
			, #{banpumImage15}
			, NOW()
			, #{updtDtm}
		)
	</insert>
	
	<select id="getBanpumMasterAllList" resultType="banpumMasterVO" parameterType="banpumMasterVO">
		SELECT 
			a.id                                                                              AS id               
			, a.banpum_name                                                                   AS banpumName       
			, a.banpum_price                                                                  AS banpumPrice
			, CONCAT(FORMAT(a.banpum_price, 0), '원')                                           AS banpumPriceStr      
			, a.banpum_qty                                                                    AS banpumQty        
			, a.banpum_description                                                            AS banpumDescription
			, a.exposure_yn                                                                   AS exposureYn       
			, a.banpum_image1                                                                 AS banpumImage1     
			, a.banpum_image2                                                                 AS banpumImage2     
			, a.banpum_image3                                                                 AS banpumImage3     
			, a.banpum_image4                                                                 AS banpumImage4     
			, a.banpum_image5                                                                 AS banpumImage5     
			, a.banpum_image6                                                                 AS banpumImage6     
			, a.banpum_image7                                                                 AS banpumImage7     
			, a.banpum_image8                                                                 AS banpumImage8     
			, a.banpum_image9                                                                 AS banpumImage9     
			, a.banpum_image10                                                                AS banpumImage10    
			, a.banpum_image11                                                                AS banpumImage11    
			, a.banpum_image12                                                                AS banpumImage12    
			, a.banpum_image13                                                                AS banpumImage13    
			, a.banpum_image14                                                                AS banpumImage14    
			, a.banpum_image15                                                                AS banpumImage15    
			, a.reg_dtm                                                                       AS regDtm           
			, a.updt_dtm                                                                      AS updtDtm          
		FROM
			banpum_master a
		<where>
		    <if test="exposureYn != null and exposureYn != ''">
		    	AND a.exposure_yn = #{exposureYn} 
		    </if>
		</where>
	</select>
	
	<select id="getBanpumMasterById" parameterType="String" resultType="banpumMasterVO">
		SELECT 
			a.id                                                                              AS id               
			, a.banpum_name                                                                   AS banpumName       
			, a.banpum_price                                                                  AS banpumPrice
			, CONCAT(FORMAT(a.banpum_price, 0), '원')                                           AS banpumPriceStr      
			, a.banpum_qty                                                                    AS banpumQty        
			, a.banpum_description                                                            AS banpumDescription
			<![CDATA[
			, REPLACE(REPLACE(a.banpum_description, '\n', '<br>'), '\r', '')               AS banpumDescriptionStr
			]]>
			, a.exposure_yn                                                                   AS exposureYn       
			, a.banpum_image1                                                                 AS banpumImage1     
			, a.banpum_image2                                                                 AS banpumImage2     
			, a.banpum_image3                                                                 AS banpumImage3     
			, a.banpum_image4                                                                 AS banpumImage4     
			, a.banpum_image5                                                                 AS banpumImage5     
			, a.banpum_image6                                                                 AS banpumImage6     
			, a.banpum_image7                                                                 AS banpumImage7     
			, a.banpum_image8                                                                 AS banpumImage8     
			, a.banpum_image9                                                                 AS banpumImage9     
			, a.banpum_image10                                                                AS banpumImage10    
			, a.banpum_image11                                                                AS banpumImage11    
			, a.banpum_image12                                                                AS banpumImage12    
			, a.banpum_image13                                                                AS banpumImage13    
			, a.banpum_image14                                                                AS banpumImage14    
			, a.banpum_image15                                                                AS banpumImage15    
			, a.reg_dtm                                                                       AS regDtm           
			, a.updt_dtm                                                                      AS updtDtm          
		FROM
			banpum_master a
		WHERE
			a.id = #{id}
	</select>
	
	<update id="updateBanpumMasterVO" parameterType="banpumMasterVO">
		UPDATE
			banpum_master
		SET
			id                        = #{id}               
			, banpum_name             = #{banpumName}       
			, banpum_price            = #{banpumPrice}      
			, banpum_qty              = #{banpumQty}        
			, banpum_description      = #{banpumDescription}
			, exposure_yn             = #{exposureYn}       
			, banpum_image1           = #{banpumImage1}     
			, banpum_image2           = #{banpumImage2}     
			, banpum_image3           = #{banpumImage3}     
			, banpum_image4           = #{banpumImage4}     
			, banpum_image5           = #{banpumImage5}     
			, banpum_image6           = #{banpumImage6}     
			, banpum_image7           = #{banpumImage7}     
			, banpum_image8           = #{banpumImage8}     
			, banpum_image9           = #{banpumImage9}     
			, banpum_image10          = #{banpumImage10}    
			, banpum_image11          = #{banpumImage11}    
			, banpum_image12          = #{banpumImage12}    
			, banpum_image13          = #{banpumImage13}    
			, banpum_image14          = #{banpumImage14}    
			, banpum_image15          = #{banpumImage15}    
			, updt_dtm                = NOW()                              
		WHERE
			id = #{id}
	</update>
	
	<delete id="deleteBanpumMasterVO" parameterType="String">
		DELETE
		FROM
			banpum_master
		WHERE
			id = #{id}
	</delete>
	
</mapper>